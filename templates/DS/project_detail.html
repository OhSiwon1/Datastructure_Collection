{% extends 'base.html' %}
{% block content %}
{% load DS_filter %}
<div class="container px-5">
<h1>{{ project.title }}</h1>
<div>
    {{ project.content|mark }}
</div>
<div>{{project.author.username}} ({{project.author.number}})</div>
{% if project.imgfile %}
  <img src="{{ project.imgfile.url }}" width="700">
{% endif %}
<h5>{{ project.comment_set.count }}개의 답변이 있습니다.</h5>
<div>
    <ul>
    {% for comment in project.comment_set.all %}
        <li>{{ comment.content }}</li>
    {% endfor %}
    </ul>
</div>

{% if messages %}
<div class="alert alert-danger my-3" role="alert">
{% for message in messages %}
    <strong>{{ message.tags }}</strong>
    <ul><li>{{ message.message }}</li></ul>
{% endfor %}
</div>
{% endif %}

<div class="my-3">
    <a href="javascript:void(0)"  onclick="vote(this)" data-uri="{% url 'project_vote' project.id  %}"
    class="btn btn-sm btn-outline-secondary"> 추천
     <span class="badge rounded-pill bg-success">{{project.harts.count}}</span>
    </a>
    {% if request.user == project.author %}
    <a href="{% url 'project_modify' project.id  %}" 
       class="btn btn-sm btn-outline-secondary">수정</a>
    <a href="javascript:void(0)" onclick="del(this)" class="delete btn btn-sm btn-outline-secondary">삭제</a>
    {% endif %}
</div>


<form action="{% url 'comments_create' project.id %}" method="post">
    {% csrf_token %}
            <!-- 오류표시 Start -->
            {% if form.errors %}
            <div class="alert alert-danger" role="alert">
                {% for field in form %}
                {% if field.errors %}
                <div>
                    <strong>{{ field.label }}</strong>
                    {{ field.errors }}
                </div>
                {% endif %}
                {% endfor %}
            </div>
            {% endif %}
            <!-- 오류표시 End -->    
        <textarea {% if not user.is_authenticated %}disabled{% endif %}
         name="content" id="content" class="form-control" rows="10"></textarea>
        <input type="submit" value="댓글작성">
    </form>
</div>
{% endblock %}

{% block script %}
<script type='text/javascript'>

    function del(el) {
      if(confirm("정말로 삭제하시겠습니까?")) {
                location.href = el.dataset.uri;
            };
    }
    function vote(el) {
      if(confirm("정말로 추천하시겠습니까?")) {
                location.href = el.dataset.uri;
            };
    }
    </script>
{% endblock %}